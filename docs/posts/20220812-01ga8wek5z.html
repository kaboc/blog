<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>リレーショナルDBへ回帰する傾向が面白い | Kabolog</title><link rel="canonical" href="https://blog.kaboc.cc/posts/20220812-01ga8wek5z"><link rel="author" href="http://www.hatena.ne.jp/kabochapo/"><link rel="shortcut icon" href="../res/images/favicon.ico"><link rel="icon" type="image/png" href="../res/images/android-chrome-192x192.png"><link rel="apple-touch-icon" href="../res/images/apple-touch-icon.png"><link rel="stylesheet" href="../res/css/styles.css?202208191920"><link rel="stylesheet" href="../res/css/github-markdown.css"><link rel="stylesheet" href="../res/css/obsidian.min.css"><meta name="title" content="リレーショナルDBへ回帰する傾向が面白い | Kabolog"><meta name="description" content="従来のリレーショナル DB（以下、RDB）を好む自分にとって嬉しい時代になってきています。 大した情報ではないですが、RDB のことを良いと思う人が増えることを期待して書きます。 RDBMS の実績 まずは RDB / RDBMS をより敬いたくなる話。 ブログ: リチャード・ヒップとのSQLiteの秘話 下の二つの引用はこのリンク先からです。 SQLite"><meta name="keywords" content="データベース"><meta name="author" content="kaboc"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.kaboc.cc/posts/20220812-01ga8wek5z"><meta property="og:image" content="https://blog.kaboc.cc/res/images/og-1200x630.jpg"><meta property="og:site_name" content="Kabolog"><meta property="og:title" content="リレーショナルDBへ回帰する傾向が面白い | Kabolog"><meta property="og:description" content="従来のリレーショナル DB（以下、RDB）を好む自分にとって嬉しい時代になってきています。 大した情報ではないですが、RDB のことを良いと思う人が増えることを期待して書きます。 RDBMS の実績 まずは RDB / RDBMS をより敬いたくなる話。 ブログ: リチャード・ヒップとのSQLiteの秘話 下の二つの引用はこのリンク先からです。 SQLite"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.kaboc.cc/res/images/og-square.jpg"><meta name="twitter:site" content="@kabochapo"><meta name="twitter:creator" content="@kabochapo"><script async src="https://www.googletagmanager.com/gtag/js?id=G-8T92E4QR06"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-8T92E4QR06');
</script></head><body><div id="blog-view"><header><p><a href="../">Kabolog</a></p></header><div id="view-content"><main><h1 id="post-title">リレーショナルDBへ回帰する傾向が面白い</h1><section id="post-meta"><ul id="category-list"><li><a href="../?c=%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9">データベース</a></li></ul><time datetime="2022-08-12T11:18:54.098078Z">2022-08-12</time></section><article class="markdown-body"><body><p>従来のリレーショナル DB（以下、RDB）を好む自分にとって嬉しい時代になってきています。<br>
大した情報ではないですが、RDB のことを良いと思う人が増えることを期待して書きます。</p>
<h1 id="RDBMS%20%E3%81%AE%E5%AE%9F%E7%B8%BE">RDBMS の実績</h1>
<p>まずは RDB / RDBMS をより敬いたくなる話。</p>
<p><a href="https://okuranagaimo.blogspot.com/2021/07/sqlite.html" target="_blank" rel="noopener">ブログ: リチャード・ヒップとのSQLiteの秘話</a><br>
下の二つの引用はこのリンク先からです。</p>
<h2 id="SQLite">SQLite</h2>
<blockquote>
<p>SQLiteは至る所にあります。ウェブブラウザにも、携帯電話にも、おそらく車の中にも、そして旅客機の中にも間違いなく存在します。iMessagesやWhatsAppのメッセージが保存されているのもSQLiteです。</p>
</blockquote>
<blockquote>
<p>テストカバレッジを90または95%にするのは非常に簡単です。最後の5%を獲得するのは本当に大変で、そこにたどり着くまでに約1年かかりましたが、そこまで到達すると、Androidからのバグレポートを受け取ることはなくなりました。<br>
（中略）<br>
それ以来、ITは順調に進んでいます。これはとても大きな違いでした。それからの8～9年間は、本当に何のバグもありませんでした。</p>
</blockquote>
<p>数十億の場所で使われている SQLite の安定性は素晴らしいですね。<br>
間違いがあってはならない旅客機の中にも。</p>
<p>私は Flutter でアプリを作るときには SQLite を使ったり別のものを使ったりしていましたが、「もう全部 SQLite でいいんじゃないか」と思うようになりました。</p>
<p>※Dart では <a href="https://pub.dev/packages/drift" target="_blank" rel="noopener">Drift</a> が便利です。</p>
<h2 id="PostgreSQL">PostgreSQL</h2>
<blockquote>
<p>彼は膨大な数のSQL文を作成し、手に入る限りのすべてのデータベースエンジンと比較しました。私たちは全員が同じ答えを得られるようにしたかったのですが、彼はPostgresを除いて、SQLiteを含む彼が試したすべてのデータベースエンジンをセグメンテーションフォールトさせることに成功しました。Postgresは常に実行され、正しい答えを出しました。私たちは、その中に欠点を見つけることはできませんでした。Postgresの人たちは、私たちの努力が足りなかっただけだと言っています。</p>
</blockquote>
<p>常に正しい Postgres…。優等生なんですね。</p>
<p>SQLite もその後に上記のとおりデバッグが行われてエラーがなくなったということで、今は同等の堅牢性があるのだと思います。</p>
<h1 id="%E8%A8%AD%E8%A8%88%E9%9D%A2">設計面</h1>
<p>ドキュメント指向の DB をここ一年半ほど使い、RDB より設計が難しいと思いました。<br>
DB と料金の両方の都合ですが、読み書きを抑える設計が必要で、そのための非正規化が面倒でした。<br>
この苦労の多い業務経験により、RDB の良さをより認識できました。</p>
<p>ドキュメント指向ではリレーションによって既存データを組み合わせることができないため、想定していなかったユースケースが後で出てくると対応できなくて辛い思いをしそうですが、どうするのでしょう。</p>
<h1 id="%E4%BD%8E%E4%BE%A1%E6%A0%BC%E3%81%AA%20RDB">低価格な RDB</h1>
<p>以前は高いサービスしかなくて、費用を気にして自分でサーバを立てると、そのメンテナンスという別のコストが生じていました。</p>
<p>それがここ数年で変わってきて、安価なサービスが現れています。</p>
<ul>
<li><a href="https://supabase.com/" target="_blank" rel="noopener">Supabase</a></li>
<li><a href="https://nhost.io/" target="_blank" rel="noopener">Nhost</a></li>
<li><a href="https://planetscale.com/" target="_blank" rel="noopener">PlanetScale</a></li>
<li>など...</li>
</ul>
<p>例えば Supabase では、PostgreSQL が使えて Auth / リアルタイム DB / Storage / Edge Functions なども込みで 25 米ドルだけです。<br>
一部は従量制ですが、DB では外向きの通信が月に 50 GB を超えなければ追加料金は発生しません。<br>
無料のプロジェクトは二つまでで、停止すればさらに作れます。</p>
<p>個人開発のアプリの一部は開発時にこのようなサービスがなかったので VPS を利用しました。<br>
今から移すのは面倒なので、開発当時に存在していなかったのが残念です。</p>
<h1 id="%E6%80%A5%E3%81%AB%E5%86%8D%E6%B3%A8%E7%9B%AE%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%20SQLite">急に再注目されている SQLite</h1>
<p>今年になって SQLite を用いたツールが続々と登場しました。</p>
<h2 id="Litestream">Litestream</h2>
<p><a href="https://litestream.io/" target="_blank" rel="noopener">https://litestream.io/</a></p>
<p>SQLite をレプリケートできるツールです。<br>
変更が S3 等のストレージに継続的にストリーミングされます。<br>
バックアップ用かなと思います。</p>
<p>安全・簡単にバックアップできれば、運用管理の負担は一つ減って安心感は増すので、SQLite をアプリのバックエンドに用いやすくなりそうです。</p>
<p>これのリリース後に作者は Fly.io に所属して改良していくことになりました。<br>
Fly.io の後ろ盾があるツールということで、今後も期待できます。</p>
<h2 id="LiteFS">LiteFS</h2>
<p><a href="https://github.com/superfly/litefs" target="_blank" rel="noopener">https://github.com/superfly/litefs</a></p>
<p>作者が Litestream と同じです。</p>
<p>こちらは FUSE ベースのファイルシステムで、クラスタ間でレプリケートできるとのことです。<br>
Litestream と違って read replica が可能になるものだと思われます。</p>
<h2 id="CloudFlare%20D1">CloudFlare D1</h2>
<p><a href="https://blog.cloudflare.com/ja-jp/introducing-d1-ja-jp/" target="_blank" rel="noopener">https://blog.cloudflare.com/ja-jp/introducing-d1-ja-jp/</a></p>
<p>これはクラウドのサービスなので上の「<a href="#%E4%BD%8E%E4%BE%A1%E6%A0%BC%E3%81%AA%20RDB">低価格な RDB</a>」に該当しますが、SQLite なのでこちらに含めました。</p>
<p>CDN のエッジにデプロイされるというのがとても新しいです。</p>
<h2 id="PocketBase">PocketBase</h2>
<p><a href="https://pocketbase.io/" target="_blank" rel="noopener">https://pocketbase.io/</a></p>
<p>Supabase に似ているけれど DB は Postgres ではなく SQLite です。<br>
自分でホストする必要がありますが、シングルバイナリになのでデプロイが非常に簡単です。</p>
<p>余談ですが、Litestream も LiteFS も PocketBase も Go 製です。<br>
Go はサーバで動かすツールに向いていていいですね。</p>
<h1 id="%E3%81%95%E3%81%84%E3%81%94%E3%81%AB">さいごに</h1>
<p>RDB を時代遅れと見る人もいる一方で、良さを見直してツールを生み出す人もいるのが面白いです。<br>
また個人開発者としては、安価で使いやすい方法が増えていて嬉しいです。</p>
<p>何かを個人で作るときには好きな方法を選べるのでいいのですが、モバイルアプリ開発の業務では NoSQL が選ばれていることが多くて辛いので、RDB がもっと使われてほしいと思っています。</p>
</body></article><section id="bottom-social-buttons"><a href="https://twitter.com/share?url=https://blog.kaboc.cc/posts/20220812-01ga8wek5z&amp;text=リレーショナルDBへ回帰する傾向が面白い&amp;via=kabochapo&amp;hashtags=Kabolog" title="ツイートする" target="_blank" rel="noopener"><img src="../res/images/twitter-button.png" alt="ツイートする" width="40" height="40"></a><a href="https://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="touch" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="40" height="40" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></section></main></div><footer><p><a href="../">Kabolog</a></p><small>&copy; 2022 kaboc</small></footer></div><script src="../res/js/highlight.min.js"></script><script>hljs.highlightAll();</script></body></html>