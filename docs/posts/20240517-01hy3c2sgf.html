<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Flutterのアダプティブ対応の動画が良かったのでポイントをまとめる | Kabolog</title><link rel="canonical" href="https://blog.kaboc.cc/posts/20240517-01hy3c2sgf"><link rel="author" href="http://www.hatena.ne.jp/kabochapo/"><link rel="shortcut icon" href="../favicon.ico"><link rel="icon" type="image/png" href="../res/images/android-chrome-192x192.png"><link rel="apple-touch-icon" href="../res/images/apple-touch-icon.png"><link rel="stylesheet" href="../res/css/styles.css?202401201235"><link rel="preload" href="../res/css/github-markdown-light.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="preload" href="../res/css/obsidian.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><meta name="title" content="Flutterのアダプティブ対応の動画が良かったのでポイントをまとめる | Kabolog"><meta name="description" content="Google I&#47;O の複数の動画が YouTube に上がっていて、たまたま見た一つが思いの外良い内容でした。 新しい情報は特にないですが、アダプティブ対応時に限らず役立つ基礎知識になるので、ウェブ検索などでたどり着く誰かのために箇条書きで残しておきます。 How to build Adaptive UI with Flutter - YouTube この"><meta name="keywords" content="Flutter"><meta name="author" content="kaboc"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.kaboc.cc/posts/20240517-01hy3c2sgf"><meta property="og:image" content="https://blog.kaboc.cc/res/images/og-1200x630.jpg"><meta property="og:site_name" content="Kabolog"><meta property="og:title" content="Flutterのアダプティブ対応の動画が良かったのでポイントをまとめる | Kabolog"><meta property="og:description" content="Google I&#47;O の複数の動画が YouTube に上がっていて、たまたま見た一つが思いの外良い内容でした。 新しい情報は特にないですが、アダプティブ対応時に限らず役立つ基礎知識になるので、ウェブ検索などでたどり着く誰かのために箇条書きで残しておきます。 How to build Adaptive UI with Flutter - YouTube この"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.kaboc.cc/res/images/og-square.jpg"><meta name="twitter:site" content="@kabochapo"><meta name="twitter:creator" content="@kabochapo"><script defer src="../res/js/highlight.min.js"></script><script>window.onload = () => hljs.highlightAll();</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-8T92E4QR06"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-8T92E4QR06');
</script></head><body><div id="blog-view"><header><p><span><a href="../">Kabolog</a></span><span id="top-social-buttons"><a href="https://kaboc.cc/"><img src="../res/images/link-home.svg" alt="Home" width="20" height="20"></a><a href="https://twitter.com/kabochapo" target="_blank" rel="noopener"><img src="../res/images/link-x.svg" alt="X" width="20" height="20"></a><a href="https://github.com/kaboc" target="_blank" rel="noopener"><img src="../res/images/link-github.svg" alt="GitHub" width="20" height="20"></a></span></p></header><div id="view-content"><main><h1 id="post-title">Flutterのアダプティブ対応の動画が良かったのでポイントをまとめる</h1><section id="post-meta"><ul id="category-list"><li><a href="../?c=Flutter">Flutter</a></li></ul><time datetime="2024-05-17T13:32:52.981953Z">2024-05-17</time></section><article class="markdown-body"><p>Google I/O の複数の動画が YouTube に上がっていて、たまたま見た一つが思いの外良い内容でした。<br>
新しい情報は特にないですが、アダプティブ対応時に限らず役立つ基礎知識になるので、ウェブ検索などでたどり着く誰かのために箇条書きで残しておきます。</p>
<p><a href="https://www.youtube.com/watch?v=LeKLGzpsz9I" target="_blank" rel="noopener">How to build Adaptive UI with Flutter - YouTube</a></p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/LeKLGzpsz9I?si=p6fuFTQC_Cna7eXP" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>
<h2 id="%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">この記事について</h2>
<p>動画内の話のとおりには書いていません。<br>
省略している部分があり、必要に応じて言い換えたり情報を少し補強したりもしています。</p>
<p>動画のタイトルにアダプティブ UI という言葉が含まれているのに記事がレスポンシブのことばかりなのは、動画がそうだったからです。<br>
デバイスの種類に依らない UI / レイアウトのことがほとんどで、アダプティブの話は入力のことと折りたたみスマホのこと、および federated plugin に関する過去動画の紹介（これは本記事では省略）くらいでした。</p>
<h2 id="SafeArea">SafeArea</h2>
<ul>
<li>ネストしても大丈夫
<ul>
<li><a href="https://github.com/flutter/flutter/blob/7f32df42187c574a5da77b9567ff3f5e7e08db5f/packages/flutter/lib/src/widgets/safe_area.dart#L106-L113" target="_blank" rel="noopener">子で指定されている padding が MediaQuery.removePadding() で除去される</a>ようになっているため
<ul>
<li>ゆえに、コンテンツを SafeArea に収めたいときに MediaQueryData の padding は直に使わずに SafeArea を使ったほうがいい</li>
</ul>
</li>
<li>アプリをアダプティブにしようとして widget の位置をあれこれ入れ替えたりしている間に SafeArea が複数になってしまってもおかしくならない</li>
</ul>
</li>
</ul>
<h3 id="AppBar">AppBar</h3>
<ul>
<li>AppBar は SafeArea に収まるように考慮されている
<ul>
<li>自分で SafeArea で包まなくていい</li>
<li>SafeArea を使うべき対象は Scaffold ではなく body</li>
</ul>
</li>
</ul>
<h2 id="MediaQuery.sizeOf()%20%E3%81%A8%20LayoutBuilder">MediaQuery.sizeOf() と LayoutBuilder</h2>
<h3 id="MediaQuery.sizeOf()">MediaQuery.sizeOf()</h3>
<ul>
<li>アプリのウインドウサイズが得られる
<ul>
<li>デバイス/画面のサイズではない</li>
<li>一つの画面上に複数のアプリを並べて表示する場合などにウインドウサイズは画面サイズと異なるので、<code>sizeOf()</code> でウインドウサイズが得られることは重要</li>
</ul>
</li>
<li>そのサイズは、密度非依存な論理ピクセル（dp）
<ul>
<li>デバイスが異なっても同じようなサイズに見えるピクセル</li>
</ul>
</li>
</ul>
<h3 id="LayoutBuilder">LayoutBuilder</h3>
<ul>
<li>親から渡された constraints が得られる
<ul>
<li>ツリー上の特定箇所のサイズ情報を得ることができる</li>
<li>固定サイズである Size ではなく最小～最大サイズの範囲である BoxConstraints
<ul>
<li>カスタムな widget を作るときには最大サイズを利用することが多い</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91">使い分け</h3>
<ul>
<li><strong>LayoutBuilder</strong>
<ul>
<li>局所的な constraints が必要なら LayoutBuilder
<ul>
<li>特定の widget に与えられるサイズに基づいたレイアウトなど
<ul>
<li>例）表示できる領域が横長の場合だけ横並びにする</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>MediaQuery.sizeOf()</strong>
<ul>
<li>アプリ全体のウインドウサイズで widget を切り替える場合に適している
<ul>
<li>ボトムナビとサイドナビの切り替えなど</li>
</ul>
</li>
</ul>
</li>
<li>Wrap、GridView を使うだけでいい場合もある</li>
</ul>
<h2 id="%E6%8A%98%E3%82%8A%E3%81%9F%E3%81%9F%E3%81%BF%E3%82%B9%E3%83%9E%E3%83%9B">折りたたみスマホ</h2>
<ul>
<li>Android で orientation を制限すると<a href="https://developer.android.com/guide/topics/large-screens/large-screen-compatibility-mode" target="_blank" rel="noopener">大画面互換性モード</a>が有効になる
<ul>
<li>レターボックスという中央に寄った表示（展開した状態の実際の幅より狭い表示）になる
<ul>
<li><code>MediaQuery.sizeOf()</code> で得られるウインドウサイズもレターボックスのサイズになる</li>
<li>レターボックスは portrait なので、<code>sizedOf()</code> で取得した値に基づいて orientation を固定すると portrait になってしまう</li>
</ul>
</li>
<li>代わりに物理的な画面のサイズの取得が必要
<ul>
<li>Flutter 3.13 で FlutterView に <code>display</code> が追加されて <code>View.maybeOf(context)?.display</code> で取得できるようになった</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B7%E3%83%96%E3%81%AE%E5%85%B7%E4%BD%93%E4%BE%8B">レスポンシブの具体例</h2>
<p>画面の一部が押されたときにコンテンツの表示をウインドウサイズで分岐して、狭ければ全画面、広ければダイアログにする例でした。<br>
自分で作るなら、全画面表示は通常の画面として作って普通に遷移し、ダイアログは <code>showDialog()</code> で開くという実装にしそうですが、動画ではどちらにも <code>Dialog</code> + <code>showDialog()</code> を使っていて参考になりました。</p>
<pre><code class="language-dart">showDialog(  
  context: context,  
  builder: (context) {  
    // コンテンツは共通  
    const dialogContent = DialogDetailScreen();  
  
    final showFullScreenDialog = MediaQuery.sizeOf(context).width &lt; 600;  
    if (showFullScreenDialog) {  
      // 全画面表示のダイアログ  
      return const Dialog.fullScreen(child: dialogContent);  
    } else {  
      return const Dialog(child: dialogContent);  
    }  
  },  
);  
</code></pre>
<h2 id="%E3%82%A2%E3%83%80%E3%83%97%E3%83%86%E3%82%A3%E3%83%96%E3%81%AA%E5%85%A5%E5%8A%9B">アダプティブな入力</h2>
<p>モバイルアプリを作るときにはタッチを唯一の入力方法と考えるかもしれませんが、Android のタブレットをサポートすることになったら入力方法を広げることも作業範囲に含まれます。</p>
<h3 id="Android%20%E3%81%AE%20Large%20screen%20app%20quality%20%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3">Android の Large screen app quality ガイドライン</h3>
<ul>
<li>三つの Tier がある
<ul>
<li>Tier 1： Large screen differentiated</li>
<li>Tier 2： Large screen optimized</li>
<li>Tier 3： Large screen ready</li>
</ul>
</li>
<li>最低限のレベル である Tier 3 でもマウスとスタイラスによる入力のサポートが必要</li>
</ul>
<h3 id="FocusableActionDetector">FocusableActionDetector</h3>
<ul>
<li><code>Shortcuts</code>、<code>Actions</code>、<code>Focus</code>、<code>MouseRegion</code> の機能を含んでいるので、入力をアダプティブにする際に便利</li>
<li>Material のライブラリでよく使われている</li>
</ul>
<h2 id="%E7%95%99%E6%84%8F%E7%82%B9%20%2F%20%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9">留意点 / ベストプラクティス</h2>
<ul>
<li><strong>orientation はなるべく固定しない</strong>
<ul>
<li>あらゆるサイズや形のデバイスをサポートすべき</li>
<li>縦向きに固定すれば MVP のスコープを狭めることはできるが、将来的にアダプティブにするときに大変</li>
<li>マルチウインドウアプリのサポートは一般的になってきている</li>
</ul>
</li>
<li><strong>widget を分割する</strong>
<ul>
<li>アダプティブ にするときに widget が分割されていると共通利用しやすい</li>
<li>小さい const な widget をたくさん持つほうがパフォーマンスの面で良い
<ul>
<li>大規模で複雑なアプリでリビルドの回数を抑えることができて効果がある</li>
</ul>
</li>
<li>小さいほうが widget が複雑にならない
<ul>
<li>読みやすい</li>
<li>リファクタリングしやすい</li>
<li>おかしな挙動になりにくい</li>
</ul>
</li>
<li>分割の基準
<ul>
<li>ない</li>
<li>widget の基準を doc コメントとして書き、そのドキュメントの複雑さで判断するといい
<ul>
<li>例えば条件によって widget の挙動が変わる場合、それをドキュメントに書いてごちゃごちゃするなら widget を分けたほうがいい</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>レイアウトの決定をデバイスの種類に頼らない</strong>
<ul>
<li>アプリのサイズは画面サイズと同じとは限らない
<ul>
<li>例
<ul>
<li>デスクトップでのウインドウをリサイズする</li>
<li>タブレットでアプリを並べて使う</li>
<li>マルチウインドウモード</li>
<li>picture-on-picture</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>MediaQueryData.orientation、OrientationBuilder にも頼らない</strong>
<ul>
<li>アプリのウインドウが持つサイズは画面の向きではわからない</li>
</ul>
</li>
<li><strong>3 レイアウトが出発点として良い</strong>
<ul>
<li>compact（～600）、medium（600～840）、expanded（840～）</li>
<li>三つでなければならないわけではない</li>
<li>ブレイクポイントは幅でなくてもいい
<ul>
<li>アプリのウィンドウサイズとピクセルratioを組み合わせてもいい</li>
<li>ゲームではもっと大きなブレイクポイントがいいかもしれない</li>
</ul>
</li>
</ul>
</li>
</ul>
</article><section id="bottom-social-buttons"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.kaboc.cc%2Fposts%2F20240517-01hy3c2sgf&amp;text=Flutter%E3%81%AE%E3%82%A2%E3%83%80%E3%83%97%E3%83%86%E3%82%A3%E3%83%96%E5%AF%BE%E5%BF%9C%E3%81%AE%E5%8B%95%E7%94%BB%E3%81%8C%E8%89%AF%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A7%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B%20%7C%20Kabolog&amp;via=kabochapo" title="Xに投稿する" target="_blank" rel="noopener"><img src="../res/images/x-share-button.svg" alt="Xに投稿する" width="36" height="36" style="margin: 2px;"></a><a href="https://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="touch" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/v4/public/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="40" height="40" style="border: none;"></a><script async src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8"></script></section></main></div><footer><p><a href="../">Kabolog</a></p><small>&copy; 2022 <a href="https://kaboc.cc/">kaboc</a></small></footer></div></body></html>